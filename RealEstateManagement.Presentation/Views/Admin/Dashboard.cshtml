@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Dashboard - Admin";
}

<div class="container mx-auto py-6 px-4">
    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Dashboard</h1>
            <p class="text-gray-600">Tổng quan hệ thống quản lý bất động sản</p>
        </div>
        <div class="flex flex-wrap gap-3 mt-4 md:mt-0">
            <button id="refreshDashboard" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                <i class="fas fa-sync-alt mr-2"></i>Làm mới
            </button>
            <div class="relative">
                <input type="text" id="dateRangePicker" placeholder="Chọn khoảng thời gian" 
                       class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
            </div>
        </div>
    </div>

    <!-- Dashboard Stats -->
    <div id="dashboard-stats">
        <!-- Stats will be loaded here -->
        <div class="flex justify-center items-center py-12">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-4 text-gray-600">Đang tải thống kê...</p>
            </div>
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
                <button data-tab="overview" class="bg-blue-600 text-white px-4 py-2 rounded-t-lg">
                    <i class="fas fa-chart-line mr-2"></i>Tổng quan
                </button>
                <button data-tab="analytics" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-t-lg hover:bg-gray-300">
                    <i class="fas fa-chart-bar mr-2"></i>Phân tích
                </button>
                <button data-tab="reports" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-t-lg hover:bg-gray-300">
                    <i class="fas fa-file-alt mr-2"></i>Báo cáo
                </button>
            </nav>
        </div>
    </div>

    <!-- Tab Contents -->
    <div class="space-y-6">
        <!-- Overview Tab -->
        <div data-tab-content="overview">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Daily Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Thống kê hàng ngày</h3>
                    <div class="h-80">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>

                <!-- Property Status Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Trạng thái bất động sản</h3>
                    <div class="h-80">
                        <canvas id="propertyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div data-tab-content="analytics" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Monthly Revenue Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Doanh thu theo tháng</h3>
                    <div class="h-80">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>

                <!-- Daily Revenue Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Doanh thu hàng ngày</h3>
                    <div class="h-80">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div data-tab-content="reports" class="hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-6">Xuất báo cáo</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Daily Reports -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Báo cáo hàng ngày</h4>
                        <div class="space-y-2">
                            <button data-report-download data-report-type="daily" data-format="excel" data-days="30" 
                                    class="w-full bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2"></i>Excel (30 ngày)
                            </button>
                            <button data-report-download data-report-type="daily" data-format="pdf" data-days="30" 
                                    class="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-2"></i>PDF (30 ngày)
                            </button>
                        </div>
                    </div>

                    <!-- Monthly Reports -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Báo cáo hàng tháng</h4>
                        <div class="space-y-2">
                            <button data-report-download data-report-type="monthly" data-format="excel" data-days="365" 
                                    class="w-full bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2"></i>Excel (1 năm)
                            </button>
                            <button data-report-download data-report-type="monthly" data-format="pdf" data-days="365" 
                                    class="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-2"></i>PDF (1 năm)
                            </button>
                        </div>
                    </div>

                    <!-- Property Reports -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Báo cáo bất động sản</h4>
                        <div class="space-y-2">
                            <button data-report-download data-report-type="property" data-format="excel" data-days="30" 
                                    class="w-full bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2"></i>Excel
                            </button>
                            <button data-report-download data-report-type="property" data-format="pdf" data-days="30" 
                                    class="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-2"></i>PDF
                            </button>
                        </div>
                    </div>

                    <!-- User Reports -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Báo cáo người dùng</h4>
                        <div class="space-y-2">
                            <button data-report-download data-report-type="user" data-format="excel" data-days="30" 
                                    class="w-full bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2"></i>Excel
                            </button>
                            <button data-report-download data-report-type="user" data-format="pdf" data-days="30" 
                                    class="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-2"></i>PDF
                            </button>
                        </div>
                    </div>

                    <!-- Revenue Reports -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Báo cáo doanh thu</h4>
                        <div class="space-y-2">
                            <button data-report-download data-report-type="revenue" data-format="excel" data-days="30" 
                                    class="w-full bg-green-600 text-white px-3 py-2 rounded text-sm hover:bg-green-700 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2"></i>Excel
                            </button>
                            <button data-report-download data-report-type="revenue" data-format="pdf" data-days="30" 
                                    class="w-full bg-red-600 text-white px-3 py-2 rounded text-sm hover:bg-red-700 flex items-center justify-center">
                                <i class="fas fa-file-pdf mr-2"></i>PDF
                            </button>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Thao tác nhanh</h4>
                        <div class="space-y-2">
                            <button onclick="AdminDashboardUI.refreshDashboard()" 
                                    class="w-full bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700 flex items-center justify-center">
                                <i class="fas fa-sync-alt mr-2"></i>Làm mới dữ liệu
                            </button>
                            <button onclick="AdminDashboardUI.loadSystemOverview()" 
                                    class="w-full bg-purple-600 text-white px-3 py-2 rounded text-sm hover:bg-purple-700 flex items-center justify-center">
                                <i class="fas fa-eye mr-2"></i>Xem tổng quan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="mt-8 bg-white rounded-lg shadow-md p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Hoạt động gần đây</h3>
        <div id="recent-activity" class="space-y-4">
            <div class="flex justify-center items-center py-8">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                    <p class="mt-2 text-gray-600 text-sm">Đang tải hoạt động...</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Date Range Picker -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    
    <!-- Admin Dashboard Services -->
    <script src="~/js/Admin/AdminDashboardService.js"></script>
    <script src="~/js/Admin/AdminDashboardUI.js"></script>
    
    <script>
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date range picker
            $('#dateRangePicker').daterangepicker({
                startDate: moment().subtract(30, 'days'),
                endDate: moment(),
                ranges: {
                    'Hôm nay': [moment(), moment()],
                    'Hôm qua': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    '7 ngày trước': [moment().subtract(6, 'days'), moment()],
                    '30 ngày trước': [moment().subtract(29, 'days'), moment()],
                    'Tháng này': [moment().startOf('month'), moment().endOf('month')],
                    'Tháng trước': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                locale: {
                    format: 'DD/MM/YYYY',
                    applyLabel: 'Áp dụng',
                    cancelLabel: 'Hủy',
                    fromLabel: 'Từ',
                    toLabel: 'Đến',
                    customRangeLabel: 'Tùy chỉnh',
                    daysOfWeek: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],
                    monthNames: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12']
                }
            });

            // Initialize dashboard
            AdminDashboardUI.init();
        });

        // Add method to load system overview
        AdminDashboardUI.loadSystemOverview = async function() {
            try {
                const overview = await AdminDashboardService.getSystemOverview();
                this.showSuccess('Tổng quan hệ thống đã được tải!');
                console.log('System Overview:', overview);
            } catch (error) {
                console.error('Error loading system overview:', error);
                this.showError('Không thể tải tổng quan hệ thống');
            }
        };
    </script>
} 
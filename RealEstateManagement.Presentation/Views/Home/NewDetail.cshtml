
﻿@{
    // ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}
<style>
    .text-orange-500 {
        color: rgb(249 115 22 / var(--tw-text-opacity, 1)) !important;
    }

    .d-none{
        display:none;
    }

    .imgDetail{
        cursor:pointer;
    }

    a {
        color: black !important;
    }

        a:hover {
            color: rgb(249 115 22 / var(--tw-text-opacity, 1)) !important;
            border-color: rgb(249 115 22 / var(--tw-border-opacity, 1));
        }
</style>
@* <h1 class="text-xl font-bold mb-4">Kênh thông tin Phòng Trọ số 1 Việt Nam</h1> *@
@* <nav class="text-sm text-blue-600 space-x-1 mb-2">
    <a href="#" class="hover:underline">Cho thuê phòng trọ</a> /
    <a href="#" class="hover:underline">Hồ Chí Minh</a> /
    <a href="#" class="hover:underline">Quận 7</a> /
    <span class="text-gray-700">Pass phòng cửa sổ lớn 175 Nguyễn Thị Thập</span>
</nav> *@

<div class="grid grid-cols-1 md:grid-cols-3 gap-6" style="margin-top:2rem">

    <div class="md:col-span-2">
        <div class="grid gap-6">
            <div class="bg-white rounded-md shadow-sm p-4">
                <div class="relative aspect-video w-full bg-white rounded-md overflow-hidden">
                    <img src="" id="imgPrimaryUrl" onerror="handleImageError(this)" alt="preview" class="object-cover w-full h-full"/>
@*                     <div class="absolute bottom-2 left-2 text-white text-xs bg-black/70 px-2 py-1 rounded">0:00 / 0:34</div> *@
                </div>

                <div id="listImgs" class="flex space-x-2 mt-4 overflow-x-auto">
@*                     <div class="border-2 border-red-500 rounded p-1">
                        <img src="https://pt123.cdn.static123.com/images/thumbs/900x600/fit/2025/06/19/2_1750340748.jpg" class="w-20 h-16 object-cover" />
                    </div>
                    <img src="https://pt123.cdn.static123.com/images/thumbs/900x600/fit/2025/06/19/2_1750340748.jpg" class="w-20 h-16 object-cover rounded" /> *@
                </div>
            </div>

            <div class="bg-white rounded-md shadow-sm p-4">
@*                 <div class="flex items-center space-x-2 mb-2">
                    <span class="text-yellow-500 text-lg font-bold">⭐⭐⭐⭐⭐</span>
                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded uppercase font-semibold">Tin VIP Nổi Bật</span>
                </div> *@
                <h1 class="text-xl font-bold text-red-600 titleId">
                </h1>
                <div class="flex items-center text-green-600 font-semibold text-lg space-x-2">
                    <span class="text-gray-700 text-base"><span class="areaId"></span></span>
                    <span class="ml-auto text-sm text-gray-500">Cập nhật: <span class="timeAgoId"></span></span>
                </div>
                <div class="text-sm text-gray-800 space-y-2 leading-relaxed">
                    <p><span class="contentId"></span></p>
                    <p><span class="summaryId"></span></p>
                </div>

        </div>
    </div>
    </div>
    <div>
        <div style="height: max-content;" class="w-full mt-4 max-w-xs bg-white p-4 rounded-md shadow-sm space-y-4 text-sm">
            <h3 class="font-semibold text-gray-800 mb-2">Tin mới đăng</h3>
            <div class="space-y-4" id="listNew">
            </div>
        </div>
    </div>
</div>

<script src="~/js/propertyService.js"></script>
<script>
    let urlBase = "https://localhost:7031";
    //document.getElementById('listPostId').classList.add("text-orange-500");
    //document.getElementById('listPostId').classList.replace("border-gray-200", "border-orange-500");
    let id = @ViewBag.Id;
    getProperty();
    async function getProperty(){
        let prop = await propertyService.getNewPostDetail(id);
        console.log(prop);
        $('.titleId').html(prop.title);
        
        const primaryImageUrl = prop.images && prop.images.length > 0 && prop.images[0] && prop.images[0].imageUrl 
            ? (prop.images[0].imageUrl.includes('http') ? prop.images[0].imageUrl : urlBase + prop.images[0].imageUrl)
            : '/image/default-news.jpg';
        $('#imgPrimaryUrl').prop('src', primaryImageUrl);
        $('.areaId').html(prop.authorName);
        $('.contentId').html(prop.content);
        $('.summaryId').html(prop.summary);
        $('.timeAgoId').html(timeAgo(prop.createdAt));
        if(!prop.isFavorite) $('#addFavoriteDetail').removeClass('d-none');
        else $('#removeFavoriteDetail').removeClass('d-none');
        let htmlUrl = "";
        $('#listImgs').html('');
        if(prop.images != null){
            prop.images.forEach((url,index) => {
                const src = url && url.imageUrl 
                    ? (url.imageUrl.includes("http") ? url.imageUrl : urlBase + url.imageUrl)
                    : '/image/default-news.jpg';
                if(index == 0) htmlUrl += `<div onclick="selectImg(this)" class="border-2 border-red-500 rounded p-1 imgDetail">
                                <img src="${src}" onerror="handleImageError(this)" class="w-20 h-16 object-cover" />
                            </div>`;
                else htmlUrl += `
                                 <div onclick="selectImg(this)" class="border-2 border-white rounded p-1 imgDetail">
                                    <img src="${src}" onerror="handleImageError(this)" class="w-20 h-16 object-cover" />
                                 </div>`;
            });
            $('#listImgs').html(htmlUrl);
        }


        //console.log(prop);
        listNewPost = await propertyService.getNewPost();
        let htmlNew = '';
        listNewPost.forEach(item => {
            if(item.id != id){
                const imageUrl = item.images && item.images.length > 0 && item.images[0] && item.images[0].imageUrl 
                    ? (item.images[0].imageUrl.includes('http') ? item.images[0].imageUrl : urlBase + item.images[0].imageUrl)
                    : '/image/default-news.jpg';
                
                htmlNew += `<div style="cursor:pointer" onclick="window.location.href='/Home/NewDetail/${item.id}'" class="flex gap-2 items-start">
                        <img src="${imageUrl}" onerror="handleImageError(this)" alt="tin" class="w-14 h-14 rounded object-cover" />
                        <div>
                            <div class="text-sm font-medium text-gray-800 leading-snug line-clamp-2">
                                ${item.title || 'Không có tiêu đề'}
                            </div>
                            <div class="text-xs text-gray-500">${timeAgo(item.publishedAt)}</div>
                        </div>
                    </div>`
            }

        });
        $('#listNew').html(htmlNew);
    }

    function selectImg(el1){
        document.querySelectorAll('.imgDetail').forEach(function(el) {
            el.classList.replace("border-red-500", "border-white");
        });
        el1.classList.replace("border-white", "border-red-500");
        const img = el1.querySelector('img');
        document.getElementById('imgPrimaryUrl').src = img.src;
    }

</script>

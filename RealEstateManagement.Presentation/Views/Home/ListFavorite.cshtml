@{
    // ViewData["Title"] = "Home Page";
    Layout = "~/Views/Shared/_LayoutV2.cshtml";
}
<style>
    .text-orange-500 {
        color: rgb(249 115 22 / var(--tw-text-opacity, 1)) !important;
    }

    a {
        color: black !important;
    }

        a:hover {
            color: rgb(249 115 22 / var(--tw-text-opacity, 1)) !important;
            border-color: rgb(249 115 22 / var(--tw-border-opacity, 1));
        }
</style>
<h1 class="text-xl font-bold mb-4">Tin đã lưu</h1>


<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <div class="md:col-span-2">
        <div id="listFavoriteId" class="grid gap-6">

        </div>
    </div>

    <div>
        <div style="height: max-content;" class="w-full max-w-xs bg-white p-4 rounded-md shadow-sm space-y-4 text-sm">
            <h3 class="font-semibold text-gray-800 mb-2">Tin mới đăng</h3>
            <div class="space-y-4" id="listNew">
            </div>
        </div>
    </div>
</div>
@* <script src="~/js/propertyService.js"></script>k *@
<script>
    let urlBase = "https://localhost:7031";
    getListFavorite();
    async function getListFavorite(){
        let listFavoriteItem = await listFavorite();
        //console.log(listFavoriteItem);
        let html = '';
        if(listFavoriteItem){
            listFavoriteItem.forEach(item => {
                html += `
                       <div class="bg-white rounded-md shadow-sm border border-gray-200 flex p-4 gap-4 items-start">

                        <div class="relative w-40 h-28 flex-shrink-0">
                                <img onerror="handleImageError(this)" src="${item.primaryImageUrl}" on alt="Phòng trọ" class="w-full h-full object-cover rounded-lg">

                            <div class="absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg">
                            </div>

                        </div>

                        <div class="flex-1">
                            <h2  onclick="window.location.href='/Home/Detail/${item.id}'" style="cursor:pointer" class="text-blue-800 font-semibold text-base leading-tight">
                                ${item.title}
                            </h2>

                            <div class="text-green-600 font-semibold mt-1">
                                       ${formatVietnameseNumber(item.price)} / tháng <span class="text-gray-500 font-normal">· ${item.area} m²</span>
                            </div>

                            <div class="text-sm text-gray-600 flex items-center gap-1 mt-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M17.657 16.657L13.414 12m0 0l-4.243 4.243M13.414 12L9.172 7.757m4.242 4.243a4 4 0 11-5.656-5.656 4 4 0 015.656 5.656z" />
                                </svg>
                                    ${item.detailedAddress}, ${item.street}, ${item.ward}, ${item.province}
                            </div>

                            <p class="text-sm text-gray-700 mt-1 line-clamp-2">
                                   ${item.description}
                            </p>

                            <div class="text-xs text-gray-400 mt-1">${timeAgo(item.createdAt)}</div>
                        </div>

                            <button onclick="removeToFavorite(${item.id})" class="mt-1 text-red-500 hover:text-red-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 6 4 4 6.5 4c1.74 0 3.41 1.01 4.13 2.44h1.75C14.09 5.01 15.76 4 17.5 4 20 4 22 6 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                            </svg>
                        </button>

                       <button
                                id="btn-compare-${item.id}"
                                onclick="addToCompare(${item.id})"
                                class="p-2 bg-white rounded-full shadow hover:bg-blue-100 transition-all duration-200"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-blue-500">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                                </svg>
                            </button>
                    </div>
                `;
            });
        }
        $('#listFavoriteId').html(html);


        listNewPost = await propertyService.getNewPost();
        //console.log(listNewPost);
        let htmlNew = '';
        listNewPost.forEach(item => {
            const imageUrl = item.images && item.images.length > 0 && item.images[0] && item.images[0].imageUrl 
                ? (item.images[0].imageUrl.includes('http') ? item.images[0].imageUrl : urlBase + item.images[0].imageUrl)
                : '/image/default-news.jpg'; // Default image path
            
            htmlNew += `<div style="cursor:pointer" onclick="window.location.href='/Home/NewDetail/${item.id}'" class="flex gap-2 items-start">
                    <img src="${imageUrl}" onerror="handleImageError(this)" alt="tin" class="w-14 h-14 rounded object-cover" />
                    <div>
                        <div class="text-sm font-medium text-gray-800 leading-snug line-clamp-2">
                            ${item.title || 'Không có tiêu đề'}
                        </div>
                        <div class="text-xs text-gray-500">${timeAgo(item.publishedAt)}</div>
                    </div>
                </div>`
        });
        $('#listNew').html(htmlNew);
    }
</script>